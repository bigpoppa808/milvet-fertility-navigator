import{j as e}from"./ui-Db5bRdDi.js";import{R as t,r as s,L as a}from"./router-BKJR1vSY.js";import{u as i,s as r,F as l,a as n}from"./index-Czm5Afhy.js";import{m as c}from"./animations-VixCDSC1.js";import{F as o}from"./BookOpenIcon-CCDWRObD.js";import{F as d}from"./CurrencyDollarIcon-Dr9DYLe_.js";import{F as m}from"./ScaleIcon-Ce3Q6xnq.js";import{F as x}from"./UsersIcon-DrhsMAo2.js";import{F as h}from"./HeartIcon-BWkCojqv.js";import{F as u}from"./ClockIcon-31jjkHyt.js";import{F as g}from"./CheckCircleIcon-B7Ah90hp.js";import"./vendor-D1VVuCdH.js";import"./supabase-BFTN-V_O.js";import"./query-wqeBDHbW.js";const p=[{name:"Search Knowledge Base",description:"Find information about fertility benefits and treatments",icon:o,href:"/knowledge",color:"bg-blue-500"},{name:"Find Funding",description:"Discover grants and assistance programs",icon:d,href:"/funding",color:"bg-green-500"},{name:"Track Legislation",description:"Stay updated on policy changes",icon:m,href:"/legislation",color:"bg-purple-500"},{name:"Share Your Story",description:"Connect with the community",icon:h,href:"/stories/new",color:"bg-red-500"}],y=t.memo(function(){const{user:t}=i(),[y,j]=s.useState({knowledgeArticles:0,fundingSources:0,activeLegislation:0,communityPosts:0}),[f,N]=s.useState([]),[w,v]=s.useState(!0),[b,_]=s.useState(null);s.useEffect(()=>{t&&(S(),k())},[t]);const k=s.useCallback(async()=>{if(t)try{const{data:e,error:s}=await r.from("profiles").select("*").eq("id",t.id).maybeSingle();s?console.error("Error fetching profile:",s):_(e)}catch(e){console.error("Error:",e)}},[t]),S=s.useCallback(async()=>{try{const[e,t,s,a]=await Promise.all([r.from("knowledge_base").select("id",{count:"exact",head:!0}),r.from("funding_sources").select("id",{count:"exact",head:!0}).eq("is_active",!0),r.from("legislation").select("id",{count:"exact",head:!0}),r.from("community_posts").select("id",{count:"exact",head:!0})]);j({knowledgeArticles:e.count||0,fundingSources:t.count||0,activeLegislation:s.count||0,communityPosts:a.count||0});const i=[],{data:l}=await r.from("legislation").select("id, title, updated_at").order("updated_at",{ascending:!1}).limit(2);l&&l.forEach(e=>{i.push({id:`leg-${e.id}`,type:"legislation_alert",title:`Updated: ${e.title}`,timestamp:e.updated_at,status:"new"})});const{data:n}=await r.from("knowledge_base").select("id, title, created_at").order("created_at",{ascending:!1}).limit(2);n&&n.forEach(e=>{i.push({id:`kb-${e.id}`,type:"knowledge_read",title:`New article: ${e.title}`,timestamp:e.created_at})});const{data:c}=await r.from("community_posts").select("id, title, created_at").order("created_at",{ascending:!1}).limit(2);c&&c.forEach(e=>{i.push({id:`post-${e.id}`,type:"community_post",title:`New discussion: ${e.title||"Community post"}`,timestamp:e.created_at})});const{data:o}=await r.from("stories").select("id, title, created_at").not("approved_at","is",null).order("created_at",{ascending:!1}).limit(2);o&&o.forEach(e=>{i.push({id:`story-${e.id}`,type:"story_shared",title:`Story shared: ${e.title||"Untitled story"}`,timestamp:e.created_at,status:"new"})}),i.sort((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()),N(i.slice(0,5))}catch(e){console.error("Error fetching dashboard data:",e)}finally{v(!1)}},[]),F=s.useMemo(()=>{const e=(new Date).getHours();return e<12?"Good morning":e<18?"Good afternoon":"Good evening"},[]),C=e=>{switch(e){case"pending":return"text-yellow-600";case"new":return"text-blue-600";case"completed":return"text-green-600";default:return"text-gray-600"}};return w?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading your dashboard..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"mb-8",children:e.jsxs(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6},children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900",children:[F,", ",b?.full_name||t?.email?.split("@")[0]||"Service Member","!"]}),e.jsx("p",{className:"mt-2 text-lg text-gray-600",children:"Welcome to your Milvet Fertility Navigator dashboard. Here's what's happening with your fertility journey."})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsx(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.1},className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(o,{className:"h-8 w-8 text-blue-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Knowledge Articles"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:y.knowledgeArticles})]})]})}),e.jsx(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.2},className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(d,{className:"h-8 w-8 text-green-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Funding Sources"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:y.fundingSources})]})]})}),e.jsx(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.3},className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(m,{className:"h-8 w-8 text-purple-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Active Legislation"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:y.activeLegislation})]})]})}),e.jsx(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.4},className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(x,{className:"h-8 w-8 text-red-600"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Community Posts"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:y.communityPosts})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Quick Actions"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:p.map((t,s)=>e.jsx(c.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.6,delay:.5+.1*s},children:e.jsx(a,{to:t.href,className:"block bg-white rounded-lg shadow p-6 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex-shrink-0 ${t.color} rounded-lg p-3`,children:e.jsx(t.icon,{className:"h-6 w-6 text-white"})}),e.jsxs("div",{className:"ml-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:t.name}),e.jsx("p",{className:"text-sm text-gray-600",children:t.description})]})]})})},t.name))})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Recent Activity"}),e.jsxs("div",{className:"bg-white rounded-lg shadow",children:[e.jsx("div",{className:"p-6",children:f.length>0?e.jsx("div",{className:"space-y-4",children:f.map(t=>{const s=(e=>{switch(e){case"funding_application":return d;case"knowledge_read":return o;case"legislation_alert":return m;case"community_post":return x;case"story_shared":return h;default:return n}})(t.type);return e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(s,{className:`h-5 w-5 ${C(t.status)}`})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:t.title}),e.jsxs("p",{className:"text-xs text-gray-500 flex items-center",children:[e.jsx(u,{className:"h-3 w-3 mr-1"}),new Date(t.timestamp).toLocaleString()]})]}),t.status&&e.jsxs("div",{className:"flex-shrink-0",children:["pending"===t.status&&e.jsx(l,{className:"h-4 w-4 text-yellow-500"}),"completed"===t.status&&e.jsx(g,{className:"h-4 w-4 text-green-500"}),"new"===t.status&&e.jsx("div",{className:"h-2 w-2 bg-blue-500 rounded-full"})]})]},t.id)})}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx(n,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"No recent activity"})]})}),e.jsx("div",{className:"border-t border-gray-200 px-6 py-3",children:e.jsx(a,{to:"/activity",className:"text-sm font-medium text-blue-600 hover:text-blue-500",children:"View all activity"})})]}),e.jsxs("div",{className:"mt-6 bg-white rounded-lg shadow p-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Profile Completion"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Basic Information"}),e.jsx(g,{className:"h-5 w-5 text-green-500"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Service Details"}),b?.service_branch?e.jsx(g,{className:"h-5 w-5 text-green-500"}):e.jsx(a,{to:"/profile",className:"text-blue-600 hover:text-blue-500 text-xs font-medium",children:"Complete"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Fertility Stage"}),b?.fertility_stage?e.jsx(g,{className:"h-5 w-5 text-green-500"}):e.jsx(a,{to:"/profile",className:"text-blue-600 hover:text-blue-500 text-xs font-medium",children:"Add"})]})]})]})]})]})]})})});export{y as DashboardPage};
