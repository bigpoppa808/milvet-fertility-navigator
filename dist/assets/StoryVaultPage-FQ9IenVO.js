import{j as e}from"./ui-Db5bRdDi.js";import{r as s}from"./router-BKJR1vSY.js";import{u as t,s as r,b as l}from"./index-Czm5Afhy.js";import{F as a,a as i}from"./HeartIcon-FelTQvRp.js";import{m as n,A as o}from"./animations-VixCDSC1.js";import{F as c,a as d}from"./ShareIcon-1kXcEFym.js";import{F as m}from"./HeartIcon-BWkCojqv.js";import"./vendor-D1VVuCdH.js";import"./supabase-BFTN-V_O.js";import"./query-wqeBDHbW.js";const x=["All Branches","Army","Navy","Air Force","Marines","Coast Guard","Space Force"],u=["All Types","Success Story","Journey in Progress","Challenge Overcome","Resource Recommendation","Support Experience"];function h(){const[h,y]=s.useState([]),[p,b]=s.useState([]),[g,j]=s.useState(!0),[f,v]=s.useState(""),[N,w]=s.useState("All Stories"),[_,S]=s.useState("All Branches"),[k,C]=s.useState("All Types"),[A,L]=s.useState(!1),[F,M]=s.useState(null),[P,B]=s.useState(new Set),[Y,T]=s.useState(!1),{user:W}=t(),[E,H]=s.useState({title:"",content:"",story_type:"Journey in Progress",consent_level:"public",is_anonymous:!1,service_branch:W?.user_metadata?.service_branch||""}),[O,R]=s.useState(null),[U,V]=s.useState(null);s.useEffect(()=>{z()},[]),s.useEffect(()=>{I()},[h,f,N,_,k]);const z=async()=>{try{const{data:e,error:s}=await r.from("stories").select("*").not("approved_at","is",null).order("created_at",{ascending:!1});s?console.error("Error fetching stories:",s):y(e||[])}catch(e){console.error("Error:",e)}finally{j(!1)}},I=()=>{let e=h;if("All Stories"!==N&&"public"===N&&(e=e.filter(e=>"public"===e.consent_level)),"All Branches"!==_&&(e=e.filter(e=>e.service_branch===_)),"All Types"!==k&&(e=e.filter(e=>e.story_type===k)),f.trim()){const s=f.toLowerCase();e=e.filter(e=>e.title&&e.title.toLowerCase().includes(s)||e.content&&e.content.toLowerCase().includes(s)||e.audio_transcript&&e.audio_transcript.toLowerCase().includes(s))}b(e)},D=e=>{switch(e?.toLowerCase()){case"hopeful":case"positive":return"bg-green-100 text-green-800";case"challenging":case"difficult":return"bg-red-100 text-red-800";case"neutral":return"bg-gray-100 text-gray-800";case"inspiring":return"bg-purple-100 text-purple-800";default:return"bg-blue-100 text-blue-800"}},G=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"});return g?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Loading stories..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("div",{className:"bg-white border-b border-gray-200",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 sm:text-4xl",children:"Military Fertility Story Vault"}),e.jsx("p",{className:"mt-4 text-lg text-gray-600 max-w-3xl mx-auto",children:"Share your fertility journey and connect with other military families. Read inspiring stories, challenges overcome, and resources that made a difference."})]}),e.jsx("div",{className:"mt-8 max-w-4xl mx-auto",children:e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(l,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Search stories by keywords, experiences, or resources...",value:f,onChange:e=>v(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("select",{value:_,onChange:e=>S(e.target.value),className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm bg-white",children:x.map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsx("select",{value:k,onChange:e=>C(e.target.value),className:"px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm bg-white",children:u.map(s=>e.jsx("option",{value:s,children:s},s))}),W&&e.jsxs("button",{onClick:()=>L(!0),className:"px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center",children:[e.jsx(a,{className:"h-4 w-4 mr-2"}),"Share Story"]})]})]})})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"flex gap-8",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"text-sm text-gray-600 mb-4",children:["Found ",p.length," stor",1!==p.length?"ies":"y"]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-2",children:p.map((s,t)=>e.jsxs(n.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1*t},className:"bg-white rounded-lg shadow border border-gray-200 overflow-hidden hover:shadow-md transition-shadow cursor-pointer",onClick:()=>M(s),children:[s.video_url&&e.jsxs("div",{className:"relative h-48 bg-gray-200",children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx("div",{className:"w-16 h-16 bg-black bg-opacity-50 rounded-full flex items-center justify-center",children:e.jsx(c,{className:"h-8 w-8 text-white ml-1"})})}),e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-red-600 text-white",children:"Video Story"})})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex items-start justify-between mb-3",children:e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:s.title||"Untitled Story"}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500 mb-3",children:[s.service_branch&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-blue-100 text-blue-800",children:s.service_branch}),s.story_type&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded text-xs font-medium bg-gray-100 text-gray-800",children:s.story_type}),s.emotional_tone&&e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-medium ${D(s.emotional_tone)}`,children:s.emotional_tone})]})]})}),s.content&&e.jsx("p",{className:"text-gray-600 mb-4 line-clamp-3",children:s.content.length>150?`${s.content.substring(0,150)}...`:s.content}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[e.jsx("span",{children:G(s.created_at)}),s.is_anonymous&&e.jsx("span",{className:"text-yellow-600",children:"Anonymous"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:e=>{var t;e.stopPropagation(),t=s.id,B(e=>{const s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s})},className:"p-2 rounded-full hover:bg-gray-100 transition-colors",children:P.has(s.id)?e.jsx(i,{className:"h-5 w-5 text-red-500"}):e.jsx(m,{className:"h-5 w-5 text-gray-400"})}),e.jsx("button",{className:"p-2 rounded-full hover:bg-gray-100 transition-colors",children:e.jsx(d,{className:"h-5 w-5 text-gray-400"})})]})]})]})]},s.id))}),0===p.length&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(m,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No stories found"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Try adjusting your search terms or filters."}),W&&e.jsxs("button",{onClick:()=>L(!0),className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700",children:[e.jsx(a,{className:"h-4 w-4 mr-2"}),"Share Your Story"]})]})]})}),e.jsxs("div",{className:"w-80 flex-shrink-0",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-6 mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Story Categories"}),e.jsx("div",{className:"space-y-2",children:u.slice(1).map(s=>e.jsx("button",{onClick:()=>C(s),className:"w-full text-left p-3 rounded-lg border transition-colors "+(k===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 hover:bg-gray-50"),children:e.jsx("div",{className:"font-medium",children:s})},s))})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow border border-gray-200 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Sharing Guidelines"}),e.jsxs("div",{className:"space-y-3 text-sm text-gray-600",children:[e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{children:"Share your authentic experience to help other military families"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{children:"Choose your privacy level: public, Hill-only, or private"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{children:"All stories are reviewed before publication"})]}),e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{children:"You can remain anonymous if preferred"})]})]})]})]})]})}),e.jsx(o,{children:F&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs(n.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-lg shadow-xl max-w-4xl max-h-[80vh] overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:F.title||"Untitled Story"}),e.jsxs("button",{onClick:()=>M(null),className:"text-gray-400 hover:text-gray-600",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]}),e.jsxs("div",{className:"mt-2 flex items-center space-x-4 text-sm text-gray-500",children:[F.service_branch&&e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:F.service_branch}),F.story_type&&e.jsx("span",{children:F.story_type}),e.jsx("span",{children:G(F.created_at)}),F.is_anonymous&&e.jsx("span",{className:"text-yellow-600",children:"Anonymous"})]})]}),e.jsxs("div",{className:"p-6 overflow-y-auto max-h-96",children:[F.video_url&&e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"aspect-video bg-gray-200 rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(c,{className:"h-12 w-12 text-gray-400 mx-auto mb-2"}),e.jsx("p",{className:"text-gray-600",children:"Video Story"})]})})}),F.content&&e.jsx("div",{className:"prose max-w-none",children:F.content.split("\n\n").map((s,t)=>e.jsx("p",{className:"mb-4 text-gray-700 leading-relaxed",children:s},t))})]})]})})}),e.jsx(o,{children:A&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",children:e.jsxs(n.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-lg shadow-xl max-w-2xl w-full",children:[e.jsx("div",{className:"p-6 border-b border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Share Your Story"}),e.jsxs("button",{onClick:()=>L(!1),className:"text-gray-400 hover:text-gray-600",children:[e.jsx("span",{className:"sr-only",children:"Close"}),e.jsx("svg",{className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Story Title *"}),e.jsx("input",{type:"text",value:E.title,onChange:e=>H(s=>({...s,title:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Give your story a meaningful title",maxLength:100})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Story Type"}),e.jsx("select",{value:E.story_type,onChange:e=>H(s=>({...s,story_type:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:u.slice(1).map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Service Branch"}),e.jsxs("select",{value:E.service_branch,onChange:e=>H(s=>({...s,service_branch:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Prefer not to say"}),x.slice(1).map(s=>e.jsx("option",{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Your Story *"}),e.jsx("textarea",{value:E.content,onChange:e=>H(s=>({...s,content:e.target.value})),rows:8,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Share your fertility journey, challenges, successes, resources that helped, or advice for other military families..."}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Share as much or as little as you're comfortable with. Your story helps others."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Add Video or Audio (Optional)"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 text-center hover:border-gray-400 transition-colors",children:[e.jsx("input",{type:"file",accept:"video/*,audio/*",onChange:e=>{const s=e.target.files?.[0];if(s)if(R(s),s.type.startsWith("video/")){const e=URL.createObjectURL(s);V(e)}else V(null)},className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer",children:e.jsx("div",{className:"space-y-2",children:O?e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:O.name}),e.jsxs("p",{className:"text-xs text-gray-500",children:[(O.size/1024/1024).toFixed(2)," MB"]}),U&&O.type.startsWith("video/")&&e.jsx("video",{src:U,controls:!0,className:"mt-4 max-w-full h-32 mx-auto rounded"}),e.jsx("button",{type:"button",onClick:()=>{R(null),V(null)},className:"mt-2 text-red-600 hover:text-red-700 text-sm",children:"Remove file"})]}):e.jsxs("div",{children:[e.jsx("svg",{className:"mx-auto h-12 w-12 text-gray-400",stroke:"currentColor",fill:"none",viewBox:"0 0 48 48",children:e.jsx("path",{d:"M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})}),e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium text-blue-600",children:"Click to upload"})," a video or audio file"]}),e.jsx("p",{className:"text-xs text-gray-500",children:"MP4, MOV, MP3, WAV up to 100MB"})]})})})]}),O&&e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:"🤖 AI will automatically transcribe audio and analyze the emotional tone of your story"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Privacy & Sharing"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Who can see your story?"}),e.jsxs("select",{value:E.consent_level,onChange:e=>H(s=>({...s,consent_level:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"public",children:"Public - Anyone can read this story"}),e.jsx("option",{value:"hill_only",children:"Hill Only - For policy advocacy use only"}),e.jsx("option",{value:"private",children:"Private - Only visible to moderators"})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:"anonymous",checked:E.is_anonymous,onChange:e=>H(s=>({...s,is_anonymous:e.target.checked})),className:"h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"}),e.jsx("label",{htmlFor:"anonymous",className:"ml-2 text-sm text-gray-700",children:"Share anonymously (don't show my name)"})]})]})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Before you submit:"}),e.jsxs("ul",{className:"text-sm text-blue-700 space-y-1",children:[e.jsx("li",{children:"• All stories are reviewed before being published"}),e.jsx("li",{children:"• Personal information will be protected"}),e.jsx("li",{children:"• You can edit or remove your story later"}),e.jsx("li",{children:"• Your story may help other military families"})]})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>L(!1),className:"px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{onClick:async()=>{if(W&&E.title.trim()&&E.content.trim()){T(!0);try{if(O){console.log("Uploading story with file:",O.name);const e=new FormData;e.append("file",O),e.append("title",E.title.trim()),e.append("content",E.content.trim()),e.append("story_type",E.story_type),e.append("consent_level",E.consent_level),e.append("is_anonymous",E.is_anonymous.toString()),e.append("service_branch",E.service_branch||"");const{data:s,error:t}=await r.functions.invoke("story-upload",{body:e});if(t)throw t;console.log("Story with file uploaded successfully:",s)}else{const{error:e}=await r.from("stories").insert({user_id:W.id,title:E.title.trim(),content:E.content.trim(),story_type:E.story_type,consent_level:E.consent_level,is_anonymous:E.is_anonymous,service_branch:E.service_branch||null,emotional_tone:"neutral"});if(e)throw e}H({title:"",content:"",story_type:"Journey in Progress",consent_level:"public",is_anonymous:!1,service_branch:W?.user_metadata?.service_branch||""}),R(null),V(null),L(!1),alert("Your story has been submitted for review. Thank you for sharing!"),z()}catch(e){console.error("Error submitting story:",e),alert("Failed to submit story. Please try again.")}finally{T(!1)}}else alert("Please fill in all required fields")},disabled:Y||!E.title.trim()||!E.content.trim(),className:"px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:Y?"Submitting...":"Submit Story"})]})]})]})})})]})}export{h as StoryVaultPage};
